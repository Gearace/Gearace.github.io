<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title> ubuntu16.04部署 · 逼格人溜溜溜 </title>
    <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<link rel="stylesheet" href="/style/style.css">
<script src="/script/jquery.min.js"></script>
<script>
    var CONFIG = {
        title: "逼格人溜溜溜",
        author: "Gearace",
        lightbox: true,
        animate: true
    }
</script>



    <link rel="stylesheet" href="/lightbox/css/lightbox.min.css">




    <link rel="stylesheet" href="/syuanpi/syuanpi.min.css">










</head>
<body>
    <div class="progress">
    <div class="progress-inner"></div>
</div>
    <div class="body">
    <div class="tagcloud" id="tagcloud">
    <div class="tagcloud-inner">
        <a href="/tags/aliyun/" style="font-size: 14px;">aliyun</a> <a href="/tags/egg-js/" style="font-size: 14px;">egg.js</a> <a href="/tags/frp/" style="font-size: 14px;">frp</a> <a href="/tags/nginx/" style="font-size: 14px;">nginx</a> <a href="/tags/nodejs/" style="font-size: 14px;">nodejs</a> <a href="/tags/ubuntu/" style="font-size: 14px;">ubuntu</a> <a href="/tags/微信小程序/" style="font-size: 14px;">微信小程序</a>
    </div>
</div>
    <header class="header" id="header">
    <div class="title syuanpi tvIn">
    <div class="table">
        <div class="connect">
            <div class="connect-inner">
                <span><a href="/">逼格人溜溜溜</a></span>
                
                    <span id="subtitle">代码有逼格儿，生活溜溜溜儿</span>
                
            </div>
        </div>
    </div>
</div>
    <nav class="main-nav syuanpi tvIn">
<div class="table">

    <ul class="menu">
        
        
            <li class="menu-item">
                <a href="/">
                    <span>文章</span>
                    
                        <span class="menu-item-label">article</span>
                    
                </a>
            </li>
        
        
        
            <li class="menu-item">
                <a href="/archives">
                    <span>归档</span>
                    
                        <span class="menu-item-label">archives</span>
                    
                </a>
            </li>
        
        
        
            <li class="menu-item">
                <a href="javascript:;" id="tags">
                    <span>标签</span>
                    
                        <span class="menu-item-label">tags</span>
                    
                </a>
            </li>
        
        
        
            <li class="menu-item">
                <a href="/about">
                    <span>关于</span>
                    
                        <span class="menu-item-label">about</span>
                    
                </a>
            </li>
        
        
    </ul>

</div>
</nav>
<div class="mobile-nav"></div>
</header>
    <div class="container">
        <main class="main" id="main">
            
    
    <article class="post">
        <header class="post-header">
            <div class="post-time syuanpi riseIn-light back-1">
                <span>2018年11月23日</span>
            </div>
            <h1 class="post-title syuanpi riseIn-light back-2">
            
                ubuntu16.04部署
            
            </h1>
            
                
                    <div class="post-tags syuanpi riseIn-light back-3">
                    
                        <a href="/tags/ubuntu/">ubuntu</a>
                    
                        <a href="/tags/aliyun/">aliyun</a>
                    
                    </div>
                
            
        </header>
        <div class="post-content syuanpi riseIn-light back-3">
            
                <h2 id="SSH连接："><a href="#SSH连接：" class="headerlink" title="SSH连接："></a>SSH连接：</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -l root 47.93.227.*</span><br><span class="line">$ ssh -p 9922 fdroot@120.227.4.*</span><br><span class="line">$ ssh -i <span class="string">"zhengshu.pem"</span> ubuntu@94.191.76.*</span><br><span class="line"><span class="comment">### 端口映射</span></span><br><span class="line">$ ssh -fN -l root -i ~/aws_tokyo.pem -L 9999:localhost:27017 ubuntu@ec2-52-197-190-115.ap-northeast-1.compute.amazonaws.com</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h2 id="ubuntu改源"><a href="#ubuntu改源" class="headerlink" title="ubuntu改源"></a>ubuntu改源</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vi /etc/apt/source.list</span><br><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get --purge remove xxx</span><br><span class="line">$ sudo apt-get autoremove</span><br><span class="line">$ service --status-all</span><br></pre></td></tr></table></figure>
<h2 id="zsh终端安装"><a href="#zsh终端安装" class="headerlink" title="zsh终端安装"></a>zsh终端安装</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="variable">$SHELL</span></span><br><span class="line">$ sudo apt-get install -y zsh</span><br><span class="line">$ sudo chsh -s $(<span class="built_in">which</span> zsh)</span><br><span class="line"><span class="comment">### 断开ssh，重连，安装ohmyzsh</span></span><br><span class="line">$ sh -c <span class="string">"(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"</span></span><br><span class="line">$ vi ~/.zshrc</span><br></pre></td></tr></table></figure>
<h2 id="Nginx安装"><a href="#Nginx安装" class="headerlink" title="Nginx安装"></a>Nginx安装</h2><h5 id="设置源"><a href="#设置源" class="headerlink" title="设置源"></a>设置源</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://nginx.org/keys/nginx_signing.key</span><br><span class="line">$ sudo apt-key add nginx_signing.key</span><br><span class="line">$ sudo add-apt-repository \</span><br><span class="line">   <span class="string">"deb http://nginx.org/packages/ubuntu/ \</span></span><br><span class="line"><span class="string">   <span class="variable">$(lsb_release -cs)</span> \</span></span><br><span class="line"><span class="string">   nginx"</span></span><br></pre></td></tr></table></figure>
<h5 id="安装Nginx"><a href="#安装Nginx" class="headerlink" title="安装Nginx"></a>安装Nginx</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install -y nginx</span><br></pre></td></tr></table></figure>
<h2 id="Docker安装"><a href="#Docker安装" class="headerlink" title="Docker安装"></a>Docker安装</h2><h5 id="设置源-1"><a href="#设置源-1" class="headerlink" title="设置源"></a>设置源</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install \</span><br><span class="line">    apt-transport-https \</span><br><span class="line">    ca-certificates \</span><br><span class="line">    curl \</span><br><span class="line">    software-properties-common</span><br><span class="line">$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class="line">$ sudo apt-key fingerprint 0EBFCD88</span><br><span class="line">$ sudo add-apt-repository \</span><br><span class="line">   <span class="string">"deb [arch=amd64] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string">   <span class="variable">$(lsb_release -cs)</span> \</span></span><br><span class="line"><span class="string">   stable"</span></span><br></pre></td></tr></table></figure>
<h5 id="安装DockerCE"><a href="#安装DockerCE" class="headerlink" title="安装DockerCE"></a>安装DockerCE</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install -y docker-ce</span><br><span class="line">$ sudo docker run hello-world</span><br></pre></td></tr></table></figure>
<h5 id="下载镜像"><a href="#下载镜像" class="headerlink" title="下载镜像"></a>下载镜像</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull node:8-alpine</span><br><span class="line">$ docker pull redis:5-alpine</span><br><span class="line">$ docker pull bianjp/mariadb-alpine:latest</span><br></pre></td></tr></table></figure>
<h5 id="启动镜像"><a href="#启动镜像" class="headerlink" title="启动镜像"></a>启动镜像</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 启动数据库</span></span><br><span class="line">$ docker run -d -p 3307:3306 -e MYSQL_ROOT_PASSWORD=toor0x --name mariadb bianjp/mariadb-alpine</span><br><span class="line"><span class="comment">### 查看镜像ip</span></span><br><span class="line">$ docker inspect mariadb</span><br><span class="line"><span class="comment">### 启动redis</span></span><br><span class="line">$ docker run -d -p 7379:6379 --name redis redis:5-alpine</span><br><span class="line"><span class="comment">### 启动应用</span></span><br><span class="line">$ docker run -d -p 8000:7001 -v /home/ubuntu/project/nxqp:/root/nxqp -v /home/ubuntu/logs:/root/logs --link mariadb:mysql --name=<span class="string">'nxqp'</span> node:8-alpine sh -c <span class="string">'cd /root/nxqp &amp;&amp; npm start'</span></span><br><span class="line"><span class="comment">### 数据备份</span></span><br><span class="line">$ docker <span class="built_in">exec</span> mariadb sh -c <span class="string">'exec mysqldump --all-databases -uroot -p"$MYSQL_ROOT_PASSWORD"'</span> &gt; /some/path/on/your/host/all-databases.sql</span><br></pre></td></tr></table></figure>
<h5 id="修改alpine时区"><a href="#修改alpine时区" class="headerlink" title="修改alpine时区"></a>修改alpine时区</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> -it nxqp sh</span><br><span class="line"><span class="comment"># date</span></span><br><span class="line"><span class="comment"># apk add -U tzdata</span></span><br><span class="line"><span class="comment"># cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span></span><br><span class="line"><span class="comment"># apk del tzdata </span></span><br><span class="line"><span class="comment"># date</span></span><br></pre></td></tr></table></figure>
<h5 id="Fix"><a href="#Fix" class="headerlink" title="Fix"></a>Fix</h5><p>docker: Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock</p>
<p><img src="../../../%E7%90%86%E8%AE%BA%E5%BD%92%E7%BA%B3/assets/image-20181207133307732-4160787.png" alt="image-20181207133307732"></p>
<p>需要给用户添加到docker组，</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 增加docker组</span></span><br><span class="line">sudo groupadd docker</span><br><span class="line"><span class="comment">### 增加用户到docker</span></span><br><span class="line">sudo gpasswd -a <span class="variable">$&#123;USER&#125;</span> docker</span><br><span class="line"><span class="comment">### 重启</span></span><br><span class="line">sudo service docker restart</span><br><span class="line"><span class="comment">### 切换会话，或者干脆重启会话</span></span><br><span class="line">newgrp - docker</span><br></pre></td></tr></table></figure>
<h5 id="mysql开宿主远程-改表"><a href="#mysql开宿主远程-改表" class="headerlink" title="mysql开宿主远程(改表)"></a>mysql开宿主远程(改表)</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> mysql;</span><br><span class="line"><span class="keyword">select</span> host,<span class="keyword">user</span>,<span class="keyword">password</span> <span class="keyword">form</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span>(host,<span class="keyword">user</span>) <span class="keyword">values</span>(<span class="string">'172.17.0.1'</span>,<span class="string">'root'</span>);</span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> <span class="keyword">password</span>=<span class="string">'*D2B664AC3636D41162EB44DF01F9ECC0AA3F8F88'</span> <span class="keyword">where</span> <span class="keyword">user</span>=<span class="string">'root'</span> <span class="keyword">and</span> host=<span class="string">'172.17.0.1'</span>;</span><br><span class="line"><span class="keyword">grant</span> ALL <span class="keyword">on</span> *.* <span class="keyword">to</span> root@<span class="string">'172.17.0.1'</span>;</span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br></pre></td></tr></table></figure>
<h5 id="mysql创建，删除，修改，授权用户-命令"><a href="#mysql创建，删除，修改，授权用户-命令" class="headerlink" title="mysql创建，删除，修改，授权用户(命令)"></a>mysql创建，删除，修改，授权用户(命令)</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> new_root;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> new_root <span class="keyword">IDENTIFIED</span> <span class="keyword">by</span> <span class="string">'password'</span>;</span><br><span class="line"><span class="keyword">rename</span> new_root <span class="keyword">to</span> sysuser;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">password</span> <span class="keyword">for</span> sysuser=<span class="keyword">password</span>(<span class="string">'password'</span>);</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">grants</span> <span class="keyword">for</span> sysuser;</span><br><span class="line"><span class="keyword">grant</span> ALL <span class="keyword">on</span> test.* <span class="keyword">to</span> sysuser;</span><br><span class="line"><span class="keyword">revoke</span> <span class="keyword">select</span>, <span class="keyword">update</span>, delect, <span class="keyword">insert</span> <span class="keyword">on</span> test.* <span class="keyword">from</span> sysuser;</span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br></pre></td></tr></table></figure>

            
        
        </div>
        
            
            
    <hr class="copy-line">
    <div class="post-copyright">
        <div class="copy-author">
            <span>作者 :</span>
            <span>Gearace</span>
        </div>
        <div class="copy-url">
            <span>地址 :</span>
            <a href="http://biger666.win/2018/11/23/ubuntu16.04部署/">http://biger666.win/2018/11/23/ubuntu16.04部署/</a>
        </div>
        <div class="copy-origin">
            <span>来源 :</span>
            <a href="http://biger666.win">http://biger666.win</a>
        </div>
        <div class="copy-license">
            
            著作权归作者所有，转载请联系作者获得授权。
        </div>
    </div>

        
    </article>
    
        
    <nav class="article-page">
        
        
            <a href="/2018/11/17/egg-js填坑/" id="art-right" class="art-left">
                <span class="prev-title"> 
                    <i class="iconfont icon-left"></i>egg.js填坑
                </span>
            </a>
        
    </nav>

        
    <i id="com-switch" class="iconfont icon-more syuanpi jumping-in long infinite" style="font-size:24px;display:block;text-align:center;"></i>
    <div class="post-comments" id="post-comments" style="display: none;margin: auto 16px;">
        
        
        
    <div class="cloud-tie-wrapper" id="cloud-tie-wrapper"></div>
    <script>
      var cloudTieConfig = {
          url: document.location.href,
          sourceId: "",
          productKey: "86144dca1df2486eaad14d94c927017a",
          target: "cloud-tie-wrapper"
      };
    </script>
    <script src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script>

        <!-- Disqus Comments -->


    </div>

    


        </main>
        <footer class="footer syuanpi fadeIn" id="footer">
    <hr>
    <div class="footer-wrapper">
        <div class="left">
            <div class="contact-icon">
    
    
    
    
    
    
    
    
        
            <a href="https://github.com/gearace" class="iconfont icon-github" title="github"></a>
        
        
        
        
        
        
        
    
        
        
            <a href="https://weibo.com/holyeah" class="iconfont icon-weibo" title="weibo"></a>
        
        
        
        
        
        
    
        
        
        
            <a href="https://twitter.com/JeaRayee" class="iconfont icon-twitter" title="twitter"></a>
        
        
        
        
        
    
</div>
        </div>
        <div class="right">
            <div class="copyright">
    <div class="info">
        <span>&copy;</span>
        <span>2017 ~ 2019</span>
        <span>❤</span>
        <span>Gearace</span>
    </div>
    <div class="theme">
        <span>
            动力来源于
            <a href="http://hexo.io/" target="_blank">Hexo </a>
        </span>
        <span>
            主题
            <a href="https://github.com/ColMugX/hexo-theme-Nlvi"> Nlvi </a>
        </span>
    </div>
    
</div>
        </div>
    </div>
</footer>
    </div>
    <script src="/script/nlvi.js"></script>

    <script src="/lightbox/js/lightbox.min.js"></script>

<script>
$(document).ready(function(){
    document.body.addEventListener('touchstart', function () {});
    $('.progress').hide();
    $('.body').show();
    Nlvi.tagcloud();
    Nlvi.back2top();
    Nlvi.showToc();
    Nlvi.showComments();
    Nlvi.showReward()

    !CONFIG.animate && Nlvi.offAnimate();
    CONFIG.lightbox && Nlvi.onPicBox();
})
</script>
    </div>
    
        
    <div class="post-toc">
        <span class="title">文章目录</span>
        <div class="toc-inner syuanpi back-1 fallIn-light">
            <li class="title-link"><a href="javascript:;" class="toTop">ubuntu16.04部署</a></li>
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#SSH连接："><span class="toc-text">SSH连接：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ubuntu改源"><span class="toc-text">ubuntu改源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#zsh终端安装"><span class="toc-text">zsh终端安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx安装"><span class="toc-text">Nginx安装</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#设置源"><span class="toc-text">设置源</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#安装Nginx"><span class="toc-text">安装Nginx</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker安装"><span class="toc-text">Docker安装</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#设置源-1"><span class="toc-text">设置源</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#安装DockerCE"><span class="toc-text">安装DockerCE</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#下载镜像"><span class="toc-text">下载镜像</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#启动镜像"><span class="toc-text">启动镜像</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#修改alpine时区"><span class="toc-text">修改alpine时区</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Fix"><span class="toc-text">Fix</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#mysql开宿主远程-改表"><span class="toc-text">mysql开宿主远程(改表)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#mysql创建，删除，修改，授权用户-命令"><span class="toc-text">mysql创建，删除，修改，授权用户(命令)</span></a></li></ol></li></ol></li></ol></li></ol>
        </div>
    </div>

    
    <div class="backtop syuanpi dead toTop" id="backtop">
    <i class="iconfont icon-up"></i>
    <span style="text-align:center;font-family:Georgia;"><span style="font-family:Georgia;" id="scrollpercent">1</span>%</span>
</div>
</body>
</html>
